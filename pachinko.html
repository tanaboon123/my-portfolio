<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡πÄ‡∏Å‡∏°‡∏õ‡∏≤‡∏à‡∏¥‡∏á‡πÇ‡∏Å‡∏∞ TT2</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f9f3ec;
      text-align: center;
    }

    h1 {
      margin-top: 30px;
      color: #d84315;
    }

    #game-container {
      position: relative;
      margin: 30px auto;
      width: 320px;
      height: 500px;
      background-color: #fff3e0;
      border: 4px solid #ff9800;
      border-radius: 10px;
      overflow: hidden;
    }

    #spinner {
      width: 100px;
      height: 100px;
      border: 8px solid #9e9e9e;
      border-top: 8px solid silver;
      border-radius: 50%;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      cursor: grab;
      transition: transform 0.2s;
    }

    #ball {
      width: 20px;
      height: 20px;
      background-color: silver;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 480px;
      display: none;
    }

    #catch-slot {
      position: absolute;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 10px;
      background-color: #4caf50;
      border-radius: 5px;
    }

    #slot-machine {
      margin-top: 20px;
      font-size: 2em;
    }

    #high-score {
      margin-top: 10px;
      font-size: 1.2em;
      color: #2e7d32;
    }
  </style>
</head>
<body>
  <h1>üé∞ ‡πÄ‡∏Å‡∏°‡∏õ‡∏≤‡∏à‡∏¥‡∏á‡πÇ‡∏Å‡∏∞ TT2 üéâ</h1>

  <div id="game-container">
    <div id="catch-slot"></div>
    <div id="ball"></div>
    <div id="spinner"></div>
  </div>

  <div id="slot-machine">üçí üçã üîî</div>
  <div id="high-score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: <span id="score-value">0</span></div>

  <script>
    const spinner = document.getElementById("spinner");
    const ball = document.getElementById("ball");
    const gameContainer = document.getElementById("game-container");
    const catchSlot = document.getElementById("catch-slot");
    const slotMachine = document.getElementById("slot-machine");
    const highScoreSpan = document.getElementById("score-value");

    let isDragging = false;
    let startAngle = 0;
    let spinPower = 0;
    let animationId;
    let isBallActive = false;
    let ballY = 0;
    let ballVelocity = 0;
    const gravity = 0.8;
    let highScore = localStorage.getItem("pachinkoHighScore") || 0;
    highScoreSpan.textContent = highScore;

    spinner.addEventListener("mousedown", (e) => {
      if (isBallActive) return;
      isDragging = true;
      startAngle = e.clientX;
      spinner.style.cursor = "grabbing";
    });

    window.addEventListener("mouseup", () => {
      if (isDragging) {
        isDragging = false;
        spinner.style.cursor = "grab";
        launchBall(spinPower);
      }
    });

    window.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      const diff = e.clientX - startAngle;
      spinPower = Math.min(Math.abs(diff), 50);
      spinner.style.transform = `translateX(-50%) rotate(${diff}deg)`;
    });

    function launchBall(power) {
      if (isBallActive) return;
      ball.style.display = "block";
      ball.style.left = "50%";
      ballY = gameContainer.clientHeight - 20;
      ball.style.top = ballY + "px";
      ballVelocity = -power * 0.6;
      isBallActive = true;
      animationId = requestAnimationFrame(animateBall);
    }

    function animateBall() {
      ballVelocity += gravity;
      ballY += ballVelocity;

      if (ballY <= 30) {
        // ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
        ballY = 30;
        ballVelocity *= -0.5;
      }

      ball.style.top = ballY + "px";

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á
      const slotRect = catchSlot.getBoundingClientRect();
      const ballRect = ball.getBoundingClientRect();

      if (
        ballY < slotRect.bottom - gameContainer.getBoundingClientRect().top &&
        Math.abs(ballRect.left + 10 - (slotRect.left + slotRect.width / 2)) < 20
      ) {
        playSlotMachine();
        gameContainer.removeChild(ball);
        createNewBall();
        isBallActive = false;
        return;
      }

      if (ballY > gameContainer.clientHeight - 20) {
        gameContainer.removeChild(ball);
        createNewBall();
        isBallActive = false;
        return;
      }

      animationId = requestAnimationFrame(animateBall);
    }

    function createNewBall() {
      const newBall = document.createElement("div");
      newBall.id = "ball";
      newBall.style.display = "none";
      gameContainer.appendChild(newBall);
      ball = newBall;
    }

    function playSlotMachine() {
      const symbols = ["üçí", "üîî", "‚≠ê", "7Ô∏è‚É£", "üçã"];
      const result = [0, 0, 0].map(() =>
        Math.floor(Math.random() * symbols.length)
      );
      const display = result.map((i) => symbols[i]).join(" ");
      slotMachine.textContent = display;

      let score = 0;
      if (result[0] === result[1] && result[1] === result[2]) {
        score = 100;
      } else if (
        result[0] === result[1] ||
        result[1] === result[2] ||
        result[0] === result[2]
      ) {
        score = 50;
      }

      if (score > 0 && score > highScore) {
        highScore = score;
        localStorage.setItem("pachinkoHighScore", highScore);
        highScoreSpan.textContent = highScore;
      }
    }
  </script>
</body>
</html>
